<html><head>
  <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
  <title>DWARF Issue</title>
</head><body>
<body>
<table style="text-align: left; width: 800px; height: 136px;" border="0">
  <tbody>
    <tr>
      <td
 style="vertical-align: middle; text-align: center; width: 153px;"><img
 src="dwarf.png" border="0"> </td>
      <td style="width: 372px;">
      <div style="text-align: center;"> </div>
      <h1 style="text-align: center;">DWARF Standard</h1>
      <div style="text-align: center;"> </div>
      </td>
    </tr>
  </tbody>
</table>
<table style="text-align: left; width: 800px; height: 26px;" border="0"
 cellpadding="0" cellspacing="0">
  <tbody>
    <tr>
      <td style="width: 168px; background-color: rgb(51, 51, 255);"><br>
      </td>
      <td
 style="text-align: center; background-color: rgb(51, 51, 255);"><a
 style="color: rgb(255, 255, 255);"
 href="/">HOME</a><br>
      </td>
      <td
 style="text-align: center; background-color: rgb(51, 51, 255);"><a
 style="color: rgb(255, 255, 255);"
 href="/Download.html">SPECIFICATIONS</a><br>
      </td>
      <td
 style="text-align: center; background-color: rgb(51, 51, 255);"><a
 style="color: rgb(255, 255, 255);"
 href="http://wiki.dwarfstd.dev/index.php?title=DWARF_FAQ">FAQ</a><br>
      </td>
      <td
 style="text-align: center; background-color: rgb(51, 51, 255);"><a
 style="color: rgb(255, 255, 255);"
 href="/issues.html">ISSUES</a><br>
      </td>
      <td style="width: 168px; background-color: rgb(51, 51, 255);"><br>
      </td>
    </tr>
  </tbody>
</table>
<br>
<br>

<table style="text-align: left; width: 794px; height: 25px;" border="1" cellpadding="2" cellspacing="2">
  <tbody>

    <tr>
      <td>090824.1</td>
      <td>Tommy Hoffner</td>
      <td>Coshape of Coarrays in Fortran 2008</td>
      <td>Enhancement</td>
      <td>Accepted with modifications</td>
      <td>John Bishop</td>
    </tr>
  </tbody>
</table>
<pre><big>


Background
----------
In Fortran, an array has a number of &quot;dimensions&quot;, one per index. 
&quot;INTEGER X(10)&quot; declares a ten-element integer array; the elements 
of X are laid out sequentially in memory.

As of the 2008 standard, Fortran also defines &quot;coarrays&quot;.  A coarray 
is an array or scalar which has at least one &quot;codimension&quot;.  
Codimensions are indexed with square brackets rather than parentheses.  
A &quot;*&quot; must be used as the size of the last codimension and means &quot;up to
a limit based on the number of processes&quot;.  The implication of a
codimension is that as the index values of the codimensions vary, 
the array elements are striped across multiple processes.  Note that
processes may be on different processors.  

For example, the coarray &quot;INTEGER X(10)[*]&quot; is a coarray of an array
of integers.  It has a dimension of 10 and a codimension of &quot;*&quot; (the 
current number of processes).  In each process there are ten elements 
laid out sequentially in memory.  In process 1 there are the ten 
elements &quot;X(1)[1]&quot; to &quot;X(10)[1]&quot;; in process 2 there are the ten 
elements &quot;X(1)[2]&quot; to &quot;X(10)[2]&quot; and so on through all the processes.  
Any process can refer to the elements in other processes using the 
square bracket notation.  References without square brackets (e.g. 
&quot;X(3)&quot;) are references to the local coarray -- the one which would be 
coindexed with the current process' process number.  There is a 
semantic difference the 'bare' reference and one using the current 
process number but that doesn't matter for DWARF.

A scalar coarray is one where there is only a codimension.  Thus 
&quot;INTEGER Y[*]&quot; is a scalar in each process but the scalars in other 
process can be referred to with the square bracket notation.


Examples 
--------

---[ Scalar that is a coarray ]---

Source:

      INTEGER X[*]

Debug data:

&lt;1&gt;&lt;100&gt; DW_TAG_coarray_type
         DW_AT_type &lt;90&gt;                 &lt;-- points to &quot;integer&quot; base type

&lt;2&gt;&lt;110&gt; DW_TAG_subrange_type
         DW_AT_lower_bound 1

&lt;1&gt;&lt;120&gt; DW_TAG_variable
         DW_AT_name &quot;X&quot;
         DW_AT_type &lt;100&gt;                 &lt;-- points to DW_TAG_coarray_type

The type of the variable &quot;X&quot; is not just the base type of integer, but a 
type which is a coarray of the base integer types.  That type has a child 
entry which is the codimension.

---[ Array that is also a coarray ]---

Source:

      INTEGER X(10)[*]

Debug data:

&lt;1&gt;&lt;200&gt; DW_TAG_array_type
         DW_AT_ordering DW_ORD_col_major
         DW_AT_type &lt;90&gt;                 &lt;-- points to &quot;integer&quot; base type

&lt;2&gt;&lt;210&gt; DW_TAG_subrange_type
         DW_AT_lower_bound 1
         DW_AT_upper_bound 10

&lt;1&gt;&lt;220&gt; DW_TAG_coarray_type
         DW_AT_type &lt;200&gt;                 &lt;-- points to DW_TAG_array_type        

&lt;2&gt;&lt;230&gt; DW_TAG_subrange_type
         DW_AT_lower_bound 1

&lt;1&gt;&lt;240&gt; DW_TAG_variable
         DW_AT_name &quot;X&quot;
         DW_AT_type &lt;220&gt;                 &lt;-- points to DW_TAG_coarray_type

---[ Multi-dimensioned array that is also a multi-dimensioned coarray ]---

Source:

      INTEGER X(10,11,12)[2,3,*]

Debug data:

&lt;1&gt;&lt;300&gt; DW_TAG_array_type
         DW_AT_ordering DW_ORD_col_major
         DW_AT_type &lt;90&gt;                 &lt;-- points to &quot;integer&quot; base type

&lt;2&gt;&lt;310&gt; DW_TAG_subrange_type
         DW_AT_lower_bound 1
         DW_AT_upper_bound 10

&lt;2&gt;&lt;320&gt; DW_TAG_subrange_type
         DW_AT_lower_bound 1
         DW_AT_upper_bound 11

&lt;2&gt;&lt;330&gt; DW_TAG_subrange_type
         DW_AT_lower_bound 1
         DW_AT_upper_bound 12

&lt;1&gt;&lt;340&gt; DW_TAG_coarray_type
         DW_AT_type &lt;300&gt;                 &lt;-- points to DW_TAG_array_type        

&lt;2&gt;&lt;350&gt; DW_TAG_subrange_type
         DW_AT_lower_bound 1
         DW_AT_upper_bound 2

&lt;2&gt;&lt;360&gt; DW_TAG_subrange_type
         DW_AT_lower_bound 1
         DW_AT_upper_bound 13

&lt;2&gt;&lt;370&gt; DW_TAG_subrange_type
         DW_AT_lower_bound 1

&lt;1&gt;&lt;380&gt; DW_TAG_variable
         DW_AT_name &quot;X&quot;
         DW_AT_type &lt;340&gt;                 &lt;-- points to DW_TAG_coarray_type

---[ end of examples ]---

Proposal:

Section 2.2, page 8:  
Figure 1, Tag names: Add DW_TAG_coarray_type after DW_TAG_base_type.

After section 5.4, page 84, add new section Section 5.5 (and renumber remaining sections):

In Fortran, a &quot;coarray&quot; is an array whose elements are located in different
processes rather than in the memory of one process. The individual elements
of a coarray can be scalars or arrays.

Coarrays are indexed by &quot;codimensions&quot; using a &quot;coindex&quot; or &quot;coindices&quot;.

<i>How coarray elements are located and how coindices are converted to
process specifications is processor-dependent.</i>

A coarray is described by a debugging information entry with the tag 
DW_TAG_coarray_type.   Like DW_TAG_array_type, these entries have 
DW_TAG_subrange_type child entries which describe the codimensions and
DW_AT_type attributes pointing to the element type.

<i>In a coarray application, the run-time number of processes in the application
is part of the coindex calculation.  It is represented in the Fortran source by
a coindex which is declared with a &quot;*&quot; as the upper bound.  To express this
concept in DWARF, the DW_TAG_subrange_type child entry for that index would have
only a lower bound and no upper bound.</i>

Figure 18, pg 154, Tag Encodings:
Add DW_TAG_coarray_type 0x44

Appendix A
Add entry for TAG DW_TAG_coarray_type
With applicable attributes:
   DECL
   DW_AT_data_location
   DW_AT_name
   DW_AT_sibling
   DW_AT_type


Appendix D.

The Fortran source in figure D.&lt;A&gt; is used to illustrate the use of
DW_TAG_coarray_type to support a variable which is a coarray of a scalar.

-----------------------------------------
      INTEGER X[*]

Figure D.&lt;A&gt; 
-----------------------------------------


Coarray Scalar Example&quot;
The DWARF representation for this is in table D.&lt;B&gt;

-----------------------------------------
10$: DW_TAG_coarray_type
         DW_AT_type( reference to INTEGER )
         DW_TAG_subrange_type
             DW_AT_lower_bound( constant 1 )

11$: DW_TAG_variable
         DW_AT_name( &quot;X&quot; )
         DW_AT_type( reference to coarray type at 10$ )

Figure D.&lt;B&gt; &quot;Coarray Scalar Example&quot; 
-----------------------------------------


Example 2, array that is also a coarray

The Fortran source in figure D.&lt;C&gt; is used to illustrate the use of 
DW_TAG_coarray_type to support a variable which is a coarray of an array.

-----------------------------------------
      INTEGER X(10)[*]

Figure D.&lt;C&gt;
-----------------------------------------

Coarray Array Example
The DWARF representation for this is in table D.&lt;D&gt;

-----------------------------------------
10$: DW_TAG_array_type
         DW_AT_ordering( DW_ORD_col_major )
         DW_AT_type( reference to INTEGER )

11$:     DW_TAG_subrange_type
             DW_AT_lower_bound( constant 1 )
             DW_AT_upper_bound( constant 10 )

12$: DW_TAG_coarray_type
         DW_AT_type( reference to array type at 10$ )

13$:     DW_TAG_subrange_type
             DW_AT_lower_bound( constant 1 )

14$: DW_TAG_variable
         DW_AT_name( &quot;X&quot; )
         DW_AT_type( reference to coarray type at $12 )

Figure D.&lt;D&gt;, Coarray Array Example
-----------------------------------------


Example 3, multi-dimensioned array that is also a multi-dimensioned coarray

The Fortran source in figure D.&lt;E&gt; is used to illustrate the use of
DW_TAG_coarray_type to support a variable which is a multi-dimensioned
coarray of a multi-dimensioned array.

-----------------------------------------
      INTEGER X(10,11,12)[2,3,*]

Figure D.&lt;E&gt; 
-----------------------------------------

Multi-dimensioned Coarray Array Example
The DWARF representation for this is in table D.&lt;F&gt;

-----------------------------------------
10$: DW_TAG_array_type
         DW_AT_ordering( DW_ORD_col_major )
         DW_AT_type( reference to INTEGER )

11$:     DW_TAG_subrange_type
             DW_AT_lower_bound( constant 1 )
             DW_AT_upper_bound( constant 10 )

12$:     DW_TAG_subrange_type
             DW_AT_lower_bound( constant  1 )
             DW_AT_upper_bound( constant 11 )

13$:     DW_TAG_subrange_type
             DW_AT_lower_bound( constant  1 )
             DW_AT_upper_bound( constant 12 )

14$: DW_TAG_coarray_type
         DW_AT_type( reference to array_type at 10$ )

15$:     DW_TAG_subrange_type
             DW_AT_lower_bound( constant 1 )
             DW_AT_upper_bound( constant 2 )

16$:     DW_TAG_subrange_type
             DW_AT_lower_bound( constant 1 )
             DW_AT_upper_bound( constant 3 )

17$:     DW_TAG_subrange_type
             DW_AT_lower_bound( constant 1 )

18$: DW_TAG_variable
         DW_AT_name( &quot;X&quot; )
         DW_AT_type( reference to coarray type at 14$ )

Figure D.&lt;F&gt;, Multi-dimensioned Coarray Array Example
-----------------------------------------

---

Revised 12/6/2012.
Revised 2/14/2013.  Previous version: http://dwarfstd.dev/issues/090824.1-1.html
Revised 4/22/2013.
Revised 5/23/2013:  Added non-normative text to Section 5.5.
		    Added Appendix D examples.
Accepted 4/23/2013 as modified.  
</big></pre>
<br><br>

<table style="text-align: left; width: 800px;" border="0" cellpadding="0" cellspacing="0">
  <small>
  </small><tbody><small>
    </small><tr><small>
      </small><td style="width: 800px; text-align: center;"><small>
      <font class="footmsg">
All logos and trademarks in this site are property of their respective
owner. <br>
The comments are property of their posters, all the rest &copy; 2007-2022
by DWARF Standards Committee.</font></small></td><small>
    </small></tr><small>
  </small></tbody><small>
  </small>
</table>

</body></html>
